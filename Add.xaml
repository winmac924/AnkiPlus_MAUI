<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="AnkiPlus_MAUI.Add"
             xmlns:skia="clr-namespace:SkiaSharp.Views.Maui.Controls;assembly=SkiaSharp.Views.Maui.Controls"
             Title="カードの追加">

        <VerticalStackLayout Padding="10"
                             Spacing="10">

                <!-- カードタイプ選択（ドロップダウン） -->
                <Picker x:Name="CardTypePicker"
                        Title="カードタイプを選択"
                        SelectedIndexChanged="OnCardTypeChanged"
                        HorizontalOptions="Fill">
                        <Picker.ItemsSource>
                                <x:Array Type="{x:Type x:String}">
                                        <x:String>基本・穴埋め</x:String>
                                        <x:String>選択肢</x:String>
                                        <x:String>画像穴埋め</x:String>
                                </x:Array>
                        </Picker.ItemsSource>
                </Picker>

                <!-- 基本・穴埋めカード入力（表・裏） -->
                <VerticalStackLayout x:Name="BasicCardLayout">
                        <HorizontalStackLayout>
                                <Label Text="表面"
                                       FontSize="16"/>
                                <!-- 画像挿入ボタン -->
                                <Button Text="画像を追加"
                                        Clicked="FrontOnAddImageClicked"
                                        HorizontalOptions="End"/>
                        </HorizontalStackLayout>
                        <Editor x:Name="FrontTextEditor"
                                HeightRequest="80"
                                Placeholder="表面の内容を入力"
                                TextChanged="FrontOnTextChanged"/>
                        
                        <!-- 装飾ボタン群 -->
                        <ScrollView Orientation="Horizontal" HorizontalScrollBarVisibility="Never">
                                <HorizontalStackLayout Spacing="5" Padding="5">
                                        <Button Text="太字" x:Name="FrontBoldButton" FontAttributes="Bold" WidthRequest="50" HeightRequest="35" FontSize="11" Clicked="OnBoldClicked"/>
                                        <Button Text="赤" BackgroundColor="Red" TextColor="White" WidthRequest="40" HeightRequest="35" FontSize="12" Clicked="OnRedColorClicked"/>
                                        <Button Text="青" BackgroundColor="Blue" TextColor="White" WidthRequest="40" HeightRequest="35" FontSize="12" Clicked="OnBlueColorClicked"/>
                                        <Button Text="緑" BackgroundColor="Green" TextColor="White" WidthRequest="40" HeightRequest="35" FontSize="12" Clicked="OnGreenColorClicked"/>
                                        <Button Text="黄" BackgroundColor="Yellow" TextColor="Black" WidthRequest="40" HeightRequest="35" FontSize="12" Clicked="OnYellowColorClicked"/>
                                        <Button Text="紫" BackgroundColor="Purple" TextColor="White" WidthRequest="40" HeightRequest="35" FontSize="12" Clicked="OnPurpleColorClicked"/>
                                        <Button Text="橙" BackgroundColor="Orange" TextColor="Black" WidthRequest="40" HeightRequest="35" FontSize="12" Clicked="OnOrangeColorClicked"/>
                                        <Button Text="上付" WidthRequest="50" HeightRequest="35" FontSize="11" Clicked="OnSuperscriptClicked"/>
                                        <Button Text="下付" WidthRequest="50" HeightRequest="35" FontSize="11" Clicked="OnSubscriptClicked"/>
                                        <Button Text="穴埋" WidthRequest="50" HeightRequest="35" FontSize="11" Clicked="OnBlankClicked"/>
                                </HorizontalStackLayout>
                        </ScrollView>
                        
                        <Label Text="プレビュー"
                               FontSize="16"/>
                        <WebView x:Name="FrontPreviewWebView"
                                 HeightRequest="80"/>
                        <HorizontalStackLayout>
                                <Label Text="裏面"
                                       FontSize="16"/>
                                <!-- 画像挿入ボタン -->
                                <Button Text="画像を追加"
                                        Clicked="BackOnAddImageClicked"
                                        HorizontalOptions="End"/>
                        </HorizontalStackLayout>
                        <Editor x:Name="BackTextEditor"
                                HeightRequest="80"
                                Placeholder="Markdown 記法で装飾できます"
                                TextChanged="BackOnTextChanged"/>
                        
                        <!-- 装飾ボタン群 -->
                        <ScrollView Orientation="Horizontal" HorizontalScrollBarVisibility="Never">
                                <HorizontalStackLayout Spacing="5" Padding="5">
                                        <Button Text="太字" x:Name="BackBoldButton" FontAttributes="Bold" WidthRequest="50" HeightRequest="35" FontSize="11" Clicked="OnBoldClicked"/>
                                        <Button Text="赤" BackgroundColor="Red" TextColor="White" WidthRequest="40" HeightRequest="35" FontSize="12" Clicked="OnRedColorClicked"/>
                                        <Button Text="青" BackgroundColor="Blue" TextColor="White" WidthRequest="40" HeightRequest="35" FontSize="12" Clicked="OnBlueColorClicked"/>
                                        <Button Text="緑" BackgroundColor="Green" TextColor="White" WidthRequest="40" HeightRequest="35" FontSize="12" Clicked="OnGreenColorClicked"/>
                                        <Button Text="黄" BackgroundColor="Yellow" TextColor="Black" WidthRequest="40" HeightRequest="35" FontSize="12" Clicked="OnYellowColorClicked"/>
                                        <Button Text="紫" BackgroundColor="Purple" TextColor="White" WidthRequest="40" HeightRequest="35" FontSize="12" Clicked="OnPurpleColorClicked"/>
                                        <Button Text="橙" BackgroundColor="Orange" TextColor="Black" WidthRequest="40" HeightRequest="35" FontSize="12" Clicked="OnOrangeColorClicked"/>
                                        <Button Text="上付" WidthRequest="50" HeightRequest="35" FontSize="11" Clicked="OnSuperscriptClicked"/>
                                        <Button Text="下付" WidthRequest="50" HeightRequest="35" FontSize="11" Clicked="OnSubscriptClicked"/>
                                        <Button Text="穴埋" WidthRequest="50" HeightRequest="35" FontSize="11" Clicked="OnBlankClicked"/>
                                </HorizontalStackLayout>
                        </ScrollView>
                        
                        <Label Text="プレビュー"
                               FontSize="16"/>
                        <WebView x:Name="BackPreviewWebView"
                                 HeightRequest="80"/>
                </VerticalStackLayout>

                <!-- 選択肢カード入力 -->
                <StackLayout x:Name="MultipleChoiceLayout"
                             IsVisible="False">
                        <Label Text="選択肢問題"
                               FontSize="16"/>
                        <Editor x:Name="ChoiceQuestion"
                                HeightRequest="80"
                                Placeholder="問題の内容を入力"/>
                        <HorizontalStackLayout>
                                <Button Text="選択肢を追加"
                                        Clicked="OnAddChoice"/>
                                <Label Text="番号を削除"
                                       VerticalOptions="Center"
                                       Margin="10,0,0,0"/>
                                <Switch x:Name="RemoveNumbersSwitch"
                                        Toggled="OnRemoveNumbersToggled"
                                        VerticalOptions="Center"/>
                        </HorizontalStackLayout>
                        <StackLayout x:Name="ChoicesContainer"/>
                        <Label Text="解説"
                               FontSize="16"/>
                        <Editor x:Name="ChoiceQuestionExplanation"
                                HeightRequest="80"
                                Placeholder="解説の内容を入力"/>
                </StackLayout>

                <!-- 画像穴埋めカード入力 -->
                <StackLayout x:Name="ImageFillLayout"
                             IsVisible="False">
                        <Label Text="画像穴埋め"
                               FontSize="16"/>
                        <HorizontalStackLayout Spacing="10">
                        <Button Text="画像を選択"
                                Clicked="OnSelectImage"
                                        HorizontalOptions="FillAndExpand"/>
                                <Button Text="画像を消去"
                                        Clicked="OnClearImage"
                                        BackgroundColor="Red"
                                        TextColor="White"
                                        HorizontalOptions="FillAndExpand"/>
                        </HorizontalStackLayout>
                        <skia:SKCanvasView x:Name="CanvasView"
                                           WidthRequest="400"
                                           HeightRequest="300"
                                           HorizontalOptions="Fill"
                                           IsEnabled="True"
                                           PaintSurface="OnCanvasViewPaintSurface"
                                           EnableTouchEvents="True"
                                           Touch="OnCanvasTouch"/>
                </StackLayout>

                <!-- カードを保存 -->
        <Button Text="カードを保存"
                        Clicked="OnSaveCardButtonClicked"
                        HorizontalOptions="Fill"
                        Margin="20,10"/>
    </VerticalStackLayout>
</ContentPage>
